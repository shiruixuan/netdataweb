!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="12eea970-b13f-4072-98cd-95f8d02fab31",e._sentryDebugIdIdentifier="sentry-dbid-12eea970-b13f-4072-98cd-95f8d02fab31")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"c87aa722cb3cb6eb3ac10b8f2032443089be80ba"},(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[5947],{65947:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});var n=a(96540),l=a(65336),r=a(47731),o=a(8711);const i=(0,o.default)(l.ModalContent).attrs((e=>{let{isMobile:t}=e;return{width:t?{base:"95vw"}:{min:120,max:160}}})).withConfig({displayName:"styled__AwsModalContent",componentId:"sc-1dvnaf6-0"})([""]),s=(0,o.default)(l.Flex).attrs((e=>({border:{side:"all",color:"primary"},color:"primary",padding:[2],justifyContent:"center",round:!0,cursor:"pointer",opacity:e.disabled?"0.4":"1",...e}))).withConfig({displayName:"styled__StyledSpaceSelector",componentId:"sc-1dvnaf6-1"})(["pointer-events:",";&:hover{background-color:",";color:#00cd51;text-decoration:none;}"],(e=>{let{disabled:t}=e;return t?"none":"auto"}),(0,l.getColor)("secondaryHighlight"));var c=a(58168);a(17333),a(98992),a(54520);const d=e=>{let{state:t,setState:a}=e;const{firstName:r,lastName:o,company:i}=t||{},[s,c]=(0,l.useTouchedState)({}),[d,u]=(0,l.useTouchedState)({}),[m,p]=(0,l.useTouchedState)({}),f=(0,n.useCallback)((e=>t=>{a((a=>({...a,[e]:t.target.value})))}),[a]);return n.createElement(l.Flex,{column:!0,gap:2},n.createElement(l.TextInput,{label:"First name",value:r||"",placeholder:"Enter your first name",onChange:f("firstName"),size:"small",touched:s,onBlur:c,error:s&&!r?"Provide your first name":""}),n.createElement(l.TextInput,{label:"Last name",value:o||"",placeholder:"Enter your last name",onChange:f("lastName"),size:"small",touched:d,onBlur:u,error:d&&!o?"Provide your last name":""}),n.createElement(l.TextInput,{label:"Company",value:i||"",placeholder:"Enter your company name",onChange:f("company"),size:"small",touched:m,onBlur:p,error:m&&!i?"Provide your company name":""}))};a(41393),a(81454);var u=a(63950),m=a.n(u),p=a(92155),f=a(80158),b=a(47130);const g=(0,p.A)((0,b.A)(s)),E=e=>{let{id:t,slug:a,name:l,isEligible:r,reason:o,isDisabled:i,onSpaceSelection:s=m()}=e;const c=(0,n.useCallback)((()=>{r&&s({spaceId:t,spaceSlug:a})}),[t,a,r,s]),d=i?"Please fill in the required fields":!r&&o?(0,f.Zr)(o):null;return n.createElement(g,{feature:"LabraSpaceSelect",payload:{spaceId:t},disabled:!r||i,tooltip:d,tooltipProps:{align:"bottom"},onClick:c},l)},h=function(){let{state:e,setState:t,eligible:a=[],nonEligible:r=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{firstName:o,lastName:i,company:s}=e||{},d=!o||!i||!s,u=(0,n.useCallback)((e=>{let{spaceId:a}=e;t((e=>({...e,spaceId:a})))}),[t]);return n.createElement(l.Flex,{column:!0,gap:4},n.createElement(l.Text,null,"Select a space to connect to your marketplace subscription."),n.createElement(l.Flex,{column:!0,gap:2,justifyContent:"center"},a.map((e=>n.createElement(E,(0,c.A)({key:e.id,onSpaceSelection:u,isDisabled:d},e)))),r.map((e=>n.createElement(E,(0,c.A)({key:e.id},e))))))};var y=a(4659);const v={ErrSubscriptionAlreadyAttached:()=>n.createElement(l.Text,{lineHeight:1.5},"This subscription is already attached to a Netdata space / account."),FETimeout:()=>n.createElement(l.Text,{lineHeight:1.5},"The subscription could not be validated. Please try again in sometime by refreshing the page. If it does not work, please reach out to"," ",n.createElement(y.A,{href:"mailto:support@netdata.cloud",as:"a",cursor:"pointer",textDecoration:"underline",color:"main"},"support@netdata.cloud")," ","and retry setting up the account from the AWS Marketplace"),default:()=>n.createElement(l.Text,null,"Something went wrong.")},S=e=>{let{errorKey:t,error:a}=e;const r=a?()=>n.createElement(l.Text,null,a):v[t]||v.default;return n.createElement(l.Flex,{alignItems:"center",justifyContent:"center",height:30,padding:[0,8]},n.createElement(r,null))};var C=a(28738);const I=e=>{let{timeLeft:t,initialTimeLeft:a}=e;const r=100-t/a*100;return n.createElement(l.Flex,null,n.createElement(l.ProgressBar,{background:"borderSecondary",border:"none",color:["green","netdata"],containerWidth:"100%","data-testid":"marketplace-subscription-progress-bar",height:2,width:`${r}%`}))},k=function(){let{state:e,setState:t,isLoading:a,timeLeft:r,initialTimeLeft:o,spaces:i=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=i.filter((e=>{let{isEligible:t}=e;return t})),c=i.filter((e=>{let{isEligible:t}=e;return!t}));return s.length?a?n.createElement(l.Flex,{column:!0,gap:2},n.createElement(C.A,{height:50,padding:[4],title:"Validating your Subscription. Please Wait.",body:"This may take upto 5 minutes."}),n.createElement(I,{timeLeft:r,initialTimeLeft:o})):n.createElement(l.Flex,{column:!0,gap:8},n.createElement(d,{state:e,setState:t}),n.createElement(h,{state:e,setState:t,eligible:s,nonEligible:c})):n.createElement(S,{error:"No eligible spaces found."})},L=e=>{let{state:t,setState:a,isLoading:l,timeLeft:r,initialTimeLeft:o,spacesLoadable:i={},error:s}=e;const{loaded:d,value:u={},hasError:m,error:p}=i;return d?m?n.createElement(S,{errorKey:p}):s?n.createElement(S,{errorKey:s.errorKey}):n.createElement(k,(0,c.A)({state:t,setState:a,isLoading:l,timeLeft:r,initialTimeLeft:o},u)):n.createElement(C.A,{height:50,padding:[4],title:"Loading spaces..."})};var w=a(3914);const T=e=>{let{state:t,forceHiddenConfirmation:a,onConfirm:r,onDecline:o}=e;const{spaceId:i}=t||{},s=(0,w.ns)(i,"name");return i&&!a?n.createElement(l.ConfirmationDialog,{confirmLabel:"Yes, select space",declineLabel:"No","data-testid":"subscribeSpaceToAWSDialog",handleConfirm:r,handleDecline:o,hideIcon:!0,isConfirmPositive:!0,message:n.createElement(l.Flex,{gap:2,column:!0},n.createElement(l.TextBig,null,"You are about to tie your subscription to ",n.createElement(l.TextBig,{strong:!0},s)," space."),n.createElement(l.TextBig,null,"Are you sure you want to select this space?")),title:"Select space"}):null};var _=a(47767),x=a(84976),A=a(47444),N=a(31629),P=a(49286);var F=a(71835);const D=(0,A.K0)({key:"labraSpacesSelector",get:e=>{let{url:t}=e;return()=>(e=>e?N.A.get(e,{transform:e=>(0,P.bn)(e)}):Promise.resolve({}))(t)}}),B=["labra_subscription_id","cloud_product_id","cloud_customer_id","cloud_provider","aws_customer_id","aws_product_id"],M=()=>{const e=(0,_.Zp)(),t=(0,w.ap)("slug"),[a,l]=(0,x.ok)();return(0,n.useCallback)((n=>{a&&(B.forEach((e=>a.delete(e))),l(a)),n?window.location.href=`/spaces/${t}`:e(`/spaces/${t}`)}),[a,l,e,t])},H=e=>{let{subscriptionId:t}=e;const[,a]=(0,F.A)();return(0,n.useCallback)((e=>{let{firstName:n,lastName:l,company:r,spaceId:o}=e;return(e=>{let{firstName:t,lastName:a,company:n,spaceId:l,subscriptionId:r}=e;return N.A.patch(`/api/v2/spaces/${l}/billing/labra/subscription`,{first_name:t,last_name:a,company:n,subscription_id:r})})({firstName:n,lastName:l,company:r,spaceId:o,subscriptionId:t}).catch(a).finally((()=>Promise.resolve()))}),[t])},K=(0,p.A)(l.Button),R=e=>{let{isLoading:t}=e;const a=M();return n.createElement(l.ModalFooter,null,n.createElement(K,{feature:"LabraSpacesSelectorClose",label:"Close",flavour:"hollow",onClick:a,disabled:t}))};var W=a(19673),$=a(99090),j=a(36712);const z=function(){let{enabled:e,onReceive:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=(0,w.vt)();(0,$.A)((()=>({enabled:e,polling:!0,fetch:()=>(0,j.PE)(a),onReceive:t,force:!0,pollingOptions:{pollingInterval:1e3}})),[a,e,t])},Y=function(){let{state:e,hasConfirmed:t,onReceive:a,onProgress:l,onStopPolling:r,waitFor:o=6e4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{spaceId:i}=e||{};z({enabled:t,onReceive:a}),(0,n.useEffect)((()=>{let e=!0,a=null,n=o;return i&&t&&(a=setInterval((()=>{n-=1e3,l?.({timeLeft:n}),0==n&&(r?.(),clearInterval(a),a=null)}),1e3)),()=>{e=!1,a&&(clearInterval(a),a=null)}}),[i,t])};var J=a(87659),Z=a(63314);const q=3e5,O=e=>{let{subCallback:t}=e;const a=(0,r.J)(),[o,s]=(0,n.useState)(),[c,d]=(0,n.useState)({}),[u,m]=(0,n.useState)(),[p,,f]=(0,J.A)(),[b,,g]=(0,J.A)(),[E,h]=(0,n.useState)(q),y=(e=>{let{url:t}=e;const a=(0,A.xf)(D({url:t}));return{loaded:"loading"!==a.state,value:a.contents?.data,hasError:"hasError"===a.state,error:a.contents?.response?.data?.errorMsgKey}})({url:t}),{value:v={}}=y||{},{subscriptionId:S}=v,C=H({subscriptionId:S}),I=M(),{refresh:k}=(0,W.JN)(),w=(0,n.useCallback)((function(){let{data:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{trialEndsAt:t}=e||{};e&&!t&&(k(),setTimeout((()=>{I()}),1e3))}),[I,k]),_=(0,n.useCallback)((e=>{let{timeLeft:t}=e;h(t)}),[h]),x=(0,n.useCallback)((()=>{m({errorKey:"FETimeout"}),s(!1)}),[m,s]);Y({state:c,hasConfirmed:b,onReceive:w,onProgress:_,onStopPolling:x,waitFor:q});const N=(0,n.useCallback)((()=>{s(!0),g(),C(c),f()}),[s,C,f,c]),P=(0,n.useCallback)((()=>{d((e=>({...e,spaceId:void 0})))}),[d]);return n.createElement(n.Fragment,null,n.createElement(l.Modal,{"data-testid":"aws-modal",backdropProps:{backdropBlur:!0}},n.createElement(Z.Ay,{feature:"LabraSpacesSelector"},n.createElement(i,{isMobile:a},n.createElement(l.ModalHeader,null,n.createElement(l.Flex,{gap:2,alignItems:"center"},n.createElement(l.Icon,{name:"netdataPress",color:"text"}),n.createElement(l.H4,null,"Welcome to Netdata!"))),n.createElement(l.ModalBody,{padding:[4,4,8,4]},n.createElement(L,{state:c,setState:d,spacesLoadable:y,isLoading:o,timeLeft:E,initialTimeLeft:q,error:u})),n.createElement(R,{isLoading:o})))),n.createElement(T,{state:c,forceHiddenConfirmation:p,onConfirm:N,onDecline:P}))}}}]);