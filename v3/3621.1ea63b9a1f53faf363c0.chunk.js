!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4802f16a-89c7-4e8f-aa35-0b39f8b999f0",e._sentryDebugIdIdentifier="sentry-dbid-4802f16a-89c7-4e8f-aa35-0b39f8b999f0")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"c87aa722cb3cb6eb3ac10b8f2032443089be80ba"},(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[3621],{63621:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});n(3064),n(41393),n(98992),n(72577),n(81454);var o=n(96540),a=n(47767),s=n(86663),r=n(31629),i=n(78969),d=n(22292),c=n(63129),u=n(71835),l=n(76201),g=n(3914),w=n(69418);const f=()=>{const e=(0,d.uW)("id"),t=(0,d.uW)("name"),n=(0,d.uW)("email"),a=(0,d.uW)("createdAt"),s=(0,d.uW)("verifiedEmail"),r=(0,d.uW)("avatarUrl"),i=(0,g.UV)("loaded"),c=(0,g.UV)("ids"),[,u,l]=(0,w.A)();(0,o.useEffect)((()=>{e&&i&&!u&&(e=>{let{avatar:t,createdAt:n,email:o,id:a,name:s,spacesCount:r,verifiedEmail:i,maxNodesCount:d}=e;if(!window.envSettings.tracking)return;if(o&&o.includes("@netdata.msdc.co"))return;if(a&&"00000000-0000-0000-0000-000000000000"===a)return;if(o&&o.includes("anonymous@netdata.cloud"))return;const c=new Date,u=c.toISOString(),l=new Date(n),g=Math.floor((c-l)/864e5);window.dataLayer&&(window.dataLayer.push({event:"UserInfoAvailable",user_id:a,userIdentifier:a,userName:s,userEmail:o,userAccountCreatedAt:n,userAccountCreatedDaysAgo:g,userAvatarURL:t,userEmailVerified:i,spacesCount:r}),window.posthog?.__loaded&&(window.posthog.identify(a),window.posthog.people.set({email:o||"unknown email",name:s,netdata_cloud_account_created_at:n,netdata_cloud_account_created_days_ago:g,spacesCount:r,maxNodesCount:d}),window.posthog.register({netdata_cloud_account_created_days_ago:g,...window.localNetdataRegistry?{...window.localNetdataRegistry.pg?{netdata_registry_person_guid:window.localNetdataRegistry.pg}:{},...window.localNetdataRegistry.mg?{netdata_registry_machine_guid:window.localNetdataRegistry.mg}:{}}:{}}),window.posthog.register_once({event_source:"cloud",netdata_cloud_account_created_at:n,netdata_cloud_account_email:o||"unknown email",netdata_cloud_account_id:a,netdata_cloud_signed_in_at:u})))})({avatar:r,createdAt:a,email:n,id:e,name:t,spacesCount:c.length,verifiedEmail:s,maxNodesCount:l})}),[e,i,u]),(0,o.useEffect)((()=>{if(window.posthog?.__loaded)try{window.posthog.onFeatureFlags((function(){window.posthog.isFeatureEnabled&&window.posthog.isFeatureEnabled("user-age-less-than-7d")&&window.posthog.startSessionRecording()}))}catch(e){}}),[])},m=()=>{if(!window.posthog?.__loaded)return;const e=(new Date).toISOString();window.posthog.register_once({event_source:"cloud",posthog_first_seen_at:e,posthog_first_distinct_id:"get_distinct_id"in window.posthog&&window.posthog.get_distinct_id()})},h=()=>(0,o.useEffect)(m,[]);var p=n(87337),_=n(9224),y=n(91069),v=n(48388),A=n(37618),b=n(33829),E=n(67276),N=n(38819),I=n(80158),C=n(79731),R=n(50876);const k=()=>{const e=(0,o.useRef)(),[,t]=(0,u.A)(),{error_msg_key:n,error_msg:a}=(0,N.PP)(),{sendLog:s}=(0,R.A)();(0,o.useEffect)((()=>{if(n&&e.current!=n){e.current=n;const o=a?(0,I.Zr)(decodeURIComponent(a)):void 0,r=(0,C.o)(n,o);t({header:"Error",text:r}),s({feature:"url-hash-error",isFailure:!0,errorMsgKey:n,message:r})}}),[e.current,n,a,t,s])},S=e=>{let{errorRetry:t,token:n,redirectUri:a}=e;const r=s.parseUrl(decodeURIComponent(t)),{url:i,query:d}=r,{redirect_uri:c}=d,u=(0,o.useRef)(!1);return u.current||(u.current=!0,window.location=`${i}?token=${n}&redirect_uri=${c||a}`),null},U=()=>{const e=(0,d.uW)("isLoaded"),t=(0,d.uW)("isAnonymous");(0,l.A)(),h(),f(),(0,o.useEffect)((()=>{if(!A.Ay){const e=window.localStorage.getItem(E.lO.visitor);if(e)window.envSettings.visitor=e;else{const e=(0,b.A)();window.localStorage.setItem(E.lO.visitor,e),window.envSettings.visitor=e}}}),[]),(0,o.useEffect)((()=>{sessionStorage.getItem(E.yq.session)||sessionStorage.setItem(E.yq.session,(0,b.A)())}),[]),k();const n=(0,a.RQ)("/sign-in/mobile-app/*"),g=(0,a.RQ)("/sign-in/*"),w=(0,a.RQ)("/sign-up/*"),m=!!g||!!w,N=(()=>{const[,e]=(0,u.A)(),t=(0,p.KF)();return(0,o.useCallback)((function(){let{origin:n,id:o,name:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n)return;const s=decodeURIComponent(o),d=decodeURIComponent(n);(0,_.ys)(o).then((n=>{let{data:o=[]}=n;return t(s,d,a),o.length?r.A.get(i._9).then((e=>{let{data:t}=e;return Promise.any(t.map((e=>r.A.get((0,y.t)({spaceId:e.id})).then((t=>{let{data:n}=t;return Promise.any(n.map((t=>(0,c.uQ)({roomId:t.id,spaceId:e.id}).then((n=>{let{nodes:a}=n;const s=a.find((e=>{let{id:t}=e;return o.includes(t)}));if(!s)throw new Error("can't find matching node");const{protocol:r,host:i}=window.location;return`${r}//${i}/spaces/${e.slug}/rooms/${t.slug}/nodes/${s.id}`})))))})))))})).catch((()=>{})):(0,_.iY)(s).then((t=>{let{data:n}=t;const{claimed:o}=n;throw e(o?{errorMsgKey:"ErrForbidden",errorMessage:"You tried to access this Node on Netdata and you don't have access to it. Please contact your Space admin to give you access to it."}:{errorMsgKey:"ErrForbidden",errorMessage:"This Node isn't connected to Netdata. Please connect it, if you have permission for it, or contact your Space admin."}),"no access"}))})).then((e=>{e&&setTimeout(location.assign(e))})).catch((()=>{}))}),[])})(),I=(0,v.A)();if(!e||I.isFetching||I.hasAccess&&!m||n)return null;const{pathname:C,search:R,hash:U}=window.location,{error_retry:D,token:P}=s.parse(U),{cloudRoute:F,redirect_uri:$,...L}=s.parse(R);if(!t&&D)return o.createElement(S,{errorRetry:D,token:P,redirectUri:$});if(!t&&m){if(F){const e=F.includes("join-callback")?decodeURI(F):F,t=Array.isArray(e)?e[0]:e;return o.createElement(a.C5,{replace:!0,to:t})}return $?(N(L),window.location.replace(decodeURIComponent($)),null):o.createElement(a.C5,{replace:!0,to:"/spaces"})}if(A.Ay)return null;if(t&&!m){const e=U.includes("join-callback")?U:encodeURIComponent(U),t=`${R}${R?"&":"?"}cloudRoute=${C}`;return o.createElement(a.C5,{replace:!0,to:{pathname:"/sign-in",search:t,hash:e}})}return null}},87337:(e,t,n)=>{n.d(t,{xN:()=>m,vS:()=>g,YN:()=>h,KF:()=>f,iw:()=>l,rE:()=>w});n(17333),n(3064),n(41393),n(14905),n(98992),n(54520),n(72577),n(81454),n(8872),n(25509),n(65223),n(60321),n(41927),n(11632),n(64377),n(66771),n(12516),n(68931),n(52514),n(35694),n(52774),n(49536),n(21926),n(94483),n(16215);var o=n(96540),a=n(47444),s=n(47767),r=n(22292);const i=(0,a.Iz)({key:"visitedNodes",default:()=>[]});var d=n(47762),c=n(9224);const u=(0,a.K0)({key:"visitedNodeIdsValue",get:e=>t=>{let{get:n}=t;return n(i(e)).map((e=>{let{id:t}=e;return t}))}}),l=()=>{const e=(0,r.NJ)(),t=(0,a.vc)(i(e)),n=(0,a.Zs)((e=>{let{set:t}=e;return e=>{t(d.gl,{values:e.reduce(((e,t)=>({...e,[t.id]:{...t,loaded:!0}})),{}),merge:!0})}}),[]);return(0,o.useEffect)((()=>{n(t)}),[t]),(0,a.vc)(u(e))},g=e=>{const t=(0,r.NJ)(),n=(0,a.vc)(i(t)),s=(0,o.useMemo)((()=>e?n.filter((t=>t.name.toUpperCase().includes(e.toUpperCase()))):n),[n,e]);return(0,o.useMemo)((()=>s.map((e=>e.id))),[s])},w=()=>(0,a.Zs)((e=>{let{snapshot:t,set:n}=e;return async(e,o)=>{const a=await t.getPromise((0,r.Dm)("id")),{urls:s,name:u}=await t.getPromise((0,d.GN)({id:e})),l=s.filter((e=>e!==o));n((0,d.GN)({id:e,key:"urls"}),l),l.length||n(i(a),(t=>t.filter((t=>t.id!==e))));try{await(l.length?(0,c.Bz)(a,e,u,l):(0,c.sm)(a,[e])),(0,c.UL)(a,e).catch((()=>{}))}catch(g){n((0,d.GN)({id:e,key:"urls"}),s)}}}),[]),f=()=>{const{pathname:e}=(0,s.zy)(),t=(0,r.NJ)(),n=m({autoFetch:!1});return(0,a.Zs)((e=>{let{snapshot:t,set:o}=e;return async(e,a,s)=>{if(await t.getPromise((0,r.Dm)("isAnonymous")))return;const u=await t.getPromise((0,r.Dm)("id")),{urls:l,name:g}=await t.getPromise((0,d.GN)({id:e}));let w=a?[a,...l]:l;w=[...new Set([window.location.href,...w])];const f=w.length!==l.length;try{o((0,d.GN)({id:e,key:"urls"}),w),o(i(u),(t=>{const n=t.find((t=>t.id===e)),o=t.filter((t=>t.id!==e));return n?[{...n,accessCount:n.accessCount+1,lastAccessTime:(new Date).toISOString()},...o]:[{accessCount:1,id:e,lastAccessTime:(new Date).toISOString(),urls:w,name:s},...o]})),f&&await(0,c.Bz)(u,e,s||g,w),n(),await(0,c.UL)(u,e)}catch(m){o((0,d.GN)({id:e,key:"urls"}),l)}}}),[n,e,t])},m=function(){let{autoFetch:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:t,isAnonymous:n}=(0,r.uW)(),[,s]=(0,a.L4)(i(t)),[d,u]=(0,o.useState)(0),l=(0,o.useCallback)((()=>{u((e=>e+1))}),[u]);return(0,o.useEffect)((()=>{if(t&&(e||d))if(n){const e=(window.visitedNodes||[]).sort(((e,t)=>new Date(t.lastAccessTime)-new Date(e.lastAccessTime)));s(e)}else(0,c.uQ)(t).then((e=>{if(!e)return;const{data:{results:t}}=e,n=t.sort(((e,t)=>new Date(t.lastAccessTime)-new Date(e.lastAccessTime)));s(n)}))}),[e,d,t,n]),l},h=()=>{const e=(0,r.NJ)(),t=i(e);return(0,a.Zs)((e=>{let{snapshot:n,set:o}=e;return async e=>{const a=(await n.getPromise((0,d.th)(e))).map((e=>e.machineGUID)),s=await n.getPromise(t),r=s.filter((e=>!a.includes(e.id)));r.length!==s.length&&o(t,r)}}),[e])}}}]);