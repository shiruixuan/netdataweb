!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ba90d265-65ef-4e72-bfb2-9eb2ce74d6fd",e._sentryDebugIdIdentifier="sentry-dbid-ba90d265-65ef-4e72-bfb2-9eb2ce74d6fd")}catch(e){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"c87aa722cb3cb6eb3ac10b8f2032443089be80ba"},(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[7103],{97103:(e,t,l)=>{l.r(t),l.d(t,{default:()=>de});var a=l(96540),o=l(65336),n=(l(41393),l(81454),l(58168));l(3064),l(98992),l(72577);const r={label:"Included",value:"INCLUDE"},s=[r,{label:"Excluded",value:"EXCLUDE"}],u=[{label:"equals",value:"equals"},{label:"starts with",value:"starts_with"},{label:"ends with",value:"ends_with"},{label:"contains",value:"contains"}],i={action:"INCLUDE",clauses:[{}]},c=e=>{let{action:t,onChange:l}=e;const n=(0,a.useMemo)((()=>s.find((e=>{let{value:l}=e;return l==t}))||r),[t]),u=(0,a.useCallback)((e=>{let{value:t}=e;return l(t)}),[l]);return a.createElement(o.Flex,{column:!0,gap:1},a.createElement(o.Text,null,"Action"),a.createElement(o.Select,{options:s,value:n,menuPortalTarget:document.body,onChange:u,styles:{size:"tiny"}}))};var d=l(8711);const m=(0,d.default)(o.Flex).attrs((e=>({height:{max:100},overflow:{vertical:"auto"},column:!0,gap:4,padding:[0,2,4,0],...e}))).withConfig({displayName:"styled__StyledRulesContainer",componentId:"sc-i1kqwo-0"})([""]),p=(0,d.default)(o.Box).withConfig({displayName:"styled__StyledRuleItemContainer",componentId:"sc-i1kqwo-1"})(["display:grid;align-items:baseline;grid-template-columns:160px auto 135px;gap:8px;"]),g=(0,d.default)(o.Flex).attrs((e=>({width:{min:80,max:80},padding:e.isEdit?[0]:[1,2],round:{side:"top",size:1},...e}))).withConfig({displayName:"styled__StyledDescriptionContainer",componentId:"sc-i1kqwo-2"})(["&:hover{background:",";cursor:pointer;}"],(0,o.getColor)("inputBg")),h=(0,d.default)(o.Flex).attrs((e=>({height:{min:7},flexWrap:!0,background:"inputBg",padding:[.2,2],gap:1,round:!0,...e}))).withConfig({displayName:"styled__StyledClausesContainer",componentId:"sc-i1kqwo-3"})([""]),b=(0,d.default)(o.Button).attrs((e=>({neutral:!0,small:!0,flavour:"borderless",label:"Add clause",icon:"plus",...e}))).withConfig({displayName:"styled__StyledAddClauseButton",componentId:"sc-i1kqwo-4"})([""]),C=(0,d.default)(o.Flex).attrs((e=>{let{isDuplicate:t,...l}=e;return{height:"20px",alignItems:"center",justifyContent:"between",round:!0,margin:[.8,0,0,0],overflow:"hidden",...t?{border:{side:"all",color:"error"}}:{},...l}})).withConfig({displayName:"styled__StyledClauseContainer",componentId:"sc-i1kqwo-5"})([""]),f=(0,d.default)(o.Flex).attrs((e=>{let{isLastEmpty:t,...l}=e;return{width:{min:20},height:"100%",alignItems:"center",justifyContent:"between",padding:[0,1.5],...t?{}:{background:"clauseBg",border:{side:"all",color:"clauseBg"}},...l}})).withConfig({displayName:"styled__StyledClauseSectionContainer",componentId:"sc-i1kqwo-6"})(["&:hover{border:1px solid ",";}"],(0,o.getColor)("textLite")),v=(0,d.default)(o.Flex).attrs((e=>({height:"20px",alignItems:"center",background:"clauseBg",padding:[0,2],...e}))).withConfig({displayName:"styled__StyledNegateContainer",componentId:"sc-i1kqwo-7"})([""]),E=(0,d.default)(o.TextSmall).attrs((e=>({fontSize:"12px",color:"clauseText",...e}))).withConfig({displayName:"styled__StyledClauseText",componentId:"sc-i1kqwo-8"})(["font-family:Arial;"]),y=(0,d.default)(o.Icon).attrs((e=>({name:"chevron_right",width:"20px",color:"clauseText",cursor:"pointer",rotate:1,...e}))).withConfig({displayName:"styled__StyledClauseSectionArrow",componentId:"sc-i1kqwo-9"})([""]),x=(0,d.default)(o.Flex).attrs((e=>({alignItems:"center",padding:[1.5,2],border:{side:"bottom",color:"border"},background:e.isSelected?"menuItemSelected":null,cursor:"pointer",...e}))).withConfig({displayName:"styled__StyledClauseOptionItem",componentId:"sc-i1kqwo-10"})(["&:hover{background:",";}"],(0,o.getColor)("secondaryHighlight")),k=(0,d.default)(o.Flex).attrs((e=>({height:"100%",alignItems:"center",padding:[0,1.5],cursor:"pointer",background:"clauseBg",...e}))).withConfig({displayName:"styled__StyledRemoveClauseIconContainer",componentId:"sc-i1kqwo-11"})([""]);var w=l(87659),I=l(47130);const S=(0,I.A)(o.Flex),A=e=>{let{index:t,description:l,onChange:n}=e;const r=(0,a.useRef)(),[s,,u,i]=(0,w.A)(),c=(0,a.useCallback)((e=>n(e.target?.value||"")),[n]);return(0,a.useEffect)((()=>{r.current&&s&&r.current.focus()}),[s,r.current]),a.createElement(g,{isEdit:s},s?a.createElement(o.TextInput,{inputRef:r,width:"100%",height:"24px",size:"small",value:l,onChange:c,onBlur:i,border:"none",_hover:{border:"none"},_focus:{border:"none"},containerStyles:{width:"100%"}}):a.createElement(S,{width:"100%",onClick:u,tooltip:s?null:"Edit rule's description.",tooltipProps:{align:"top"}},a.createElement(o.Text,null,l||`Rule ${t+1}`)))};var R=l(51220);const _=e=>{let{value:t,item:l,onClick:n}=e;const r=(0,a.useCallback)((()=>n(l.value)),[l,n]);return a.createElement(x,{isSelected:t==l.value,onClick:r},a.createElement(o.Text,null,l.label))},L=e=>{let{value:t,options:l,onItemClick:o}=e;const n=(0,a.useRef)(),r=(0,R.Te)({count:l.length,getScrollElement:()=>n.current,estimateSize:()=>29});return a.createElement(a.Fragment,null,a.createElement("div",{ref:n,style:{maxHeight:"300px",overflow:"auto"}},a.createElement("div",{style:{height:`${r.getTotalSize()}px`,width:"100%",position:"relative"}},r.getVirtualItems().map((e=>a.createElement("div",{key:e.key,style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`}},a.createElement(_,{value:t,item:l[e.index],onClick:o})))))))};l(17333),l(54520);const D=e=>{let{inputValue:t,options:l,isCreatable:o}=e;const[n,r]=(0,a.useState)(l);return(0,a.useEffect)((()=>{if(o){const e=new RegExp((t||"").toLowerCase());r(l.filter((t=>{let{label:l}=t;return e.test(l.toLowerCase())})))}}),[t,l,r,o]),{filteredOptions:n}},F=(0,d.css)(["color:",";"],(0,o.getColor)("text")),N=e=>{let{value:t,options:l,onChange:r,isCreatable:s,isLastEmpty:u,inputProps:i,dropProps:c}=e;const d=(0,a.useRef)(),m=(0,a.useRef)(),[p,g,,h]=(0,w.A)(),[b,,C,v]=(0,w.A)(),[x,k]=(0,a.useState)(t),{filteredOptions:I}=D({inputValue:x,options:l,isCreatable:s}),S=(0,a.useCallback)((()=>{s&&C(),g()}),[s,C,g]),A=(0,a.useCallback)((e=>k(e.target.value)),[k]),R=(0,a.useCallback)((()=>{r(x),v()}),[x,r,v]),_=(0,a.useCallback)((e=>{r(e),h()}),[r,h]);return(0,a.useEffect)((()=>{m.current&&b&&m.current.focus()}),[b,m.current]),a.createElement(a.Fragment,null,a.createElement(f,{ref:d,onClick:S,isLastEmpty:u},b?a.createElement(o.TextInput,(0,n.A)({inputRef:m,width:"100%",height:"18px",size:"small",value:x,onChange:A,onBlur:R,border:"none",padding:[0],_hover:{border:"none"},_focus:{border:"none"},placeholderProps:F},u?{}:{background:"clauseBg"},i)):a.createElement(o.Flex,{height:"100%",alignItems:"center",flex:"grow",cursor:s?"default":"pointer"},a.createElement(E,{color:t?"clauseText":"text"},t||i?.placeholder||"")),u?null:a.createElement(y,null)),p&&I.length&&d.current?a.createElement(o.Drop,(0,n.A)({width:{base:55,max:100},target:d.current,align:{top:"bottom",left:"left"},background:"modalBackground",border:{side:"all",color:"border"},margin:[1,0,0],round:1,close:h,onClickOutside:h,onEsc:h},c),a.createElement(L,{value:t,options:I,onItemClick:_})):null)};var T=l(47444),B=l(7484);const $=(0,T.Iz)({key:"hostLabelKeys",default:e=>(0,B.xq)(e)});var P=l(3914);const q=(0,T.K0)({key:"hostLabelKeyValuesState",get:e=>{let{spaceId:t,key:l}=e;return async()=>{if(!l)return{values:[]};return await(0,B.wy)(t,l)}}}),M=e=>{let{label:t,...l}=e;const{loaded:o,value:r=[],hasError:s}=(()=>{const e=(0,P.vt)(),t=(0,T.xf)($(e));return{loaded:"loading"!==t.state,value:t.contents?.data?.keys,hasError:"hasError"===t.state}})(),u=(0,a.useMemo)((()=>o&&!s?r.map((e=>({label:e,value:e}))):[]),[o,r,s]);return a.createElement(N,(0,n.A)({value:t,options:u,inputProps:{placeholder:"Select label..."},isCreatable:!0},l))},z=e=>{let{operator:t,...l}=e;return a.createElement(N,(0,n.A)({value:t,options:u,inputProps:{placeholder:"Select operator..."},dropProps:{width:20}},l))},O=(0,I.A)(v),V=e=>{let{negate:t,onChange:l}=e;return a.createElement(O,{tooltip:"Check this to invert the selected operator evaluation"},a.createElement(o.Checkbox,{label:"not",labelPosition:"left",labelProps:{color:"clauseText"},checked:t,onChange:l}))},Y=e=>{let{selectedLabel:t,value:l,...o}=e;const{loaded:r,value:s=[],hasError:u}=(e=>{let{key:t}=e;const l=(0,P.vt)(),a=(0,T.xf)(q({spaceId:l,key:t}));return{loaded:"loading"!==a.state,value:a.contents?.data?.values,hasError:"hasError"===a.state}})({key:t}),i=(0,a.useMemo)((()=>r&&!u?s.map((e=>({label:e,value:e}))):[]),[r,s,u]);return a.createElement(N,(0,n.A)({value:l,options:i,inputProps:{placeholder:"Select value..."},isCreatable:!0},o))};var K=l(32089);const U=e=>{let{index:t,clause:l,clauses:o,onEditClause:n,onRemoveClause:r}=e;const[s,u]=(0,a.useState)(l),i=(0,a.useCallback)((e=>u((t=>({...t,label:e})))),[u]),c=(0,a.useCallback)((e=>u((t=>({...t,operator:e})))),[u]),d=(0,a.useCallback)((e=>u((t=>({...t,negate:e})))),[u]),m=(0,a.useCallback)((e=>u((t=>({...t,value:e})))),[u]),p=(0,a.useCallback)((()=>r(t)),[t,r]),g=(0,a.useMemo)((()=>s.label&&s.operator&&s.value),[s]),h=(0,a.useCallback)((e=>{switch(e){case"label":return!s.label&&!s.operator&&!s.value;case"operator":return!!s.label&&!s.operator;case"value":return!!s.label&&!!s.operator&&!s.value;default:return!1}}),[s]),b=(0,a.useMemo)((()=>({label:!0,operator:!!s.label||!!s.operator,value:!!s.operator||!!s.value})),[s]),C=(0,a.useMemo)((()=>!!o.slice(0,t).find((e=>e.label==s.label&&e.operator==s.operator&&e.value==s.value))),[t,o,s]);return(0,a.useEffect)((()=>{u(l)}),[l]),(0,a.useEffect)((()=>{const{label:e,operator:l,value:a}=s||{};e&&l&&a&&n(s,t)}),[t,s,n]),{state:s,showRemoveIcon:g,onLabelChange:i,onOperatorChange:c,onNegateChange:d,onValueChange:m,onRemove:p,sectionsVisibility:b,isLastEmptyField:h,isDuplicate:C}},H=(0,I.A)(C),J=e=>{let{index:t,clause:l,clauses:n,onEditClause:r,onRemoveClause:s}=e;const{state:u,showRemoveIcon:i,onLabelChange:c,onOperatorChange:d,onNegateChange:m,onValueChange:p,onRemove:g,sectionsVisibility:h,isLastEmptyField:b,isDuplicate:C}=U({index:t,clause:l,clauses:n,onEditClause:r,onRemoveClause:s}),f=(0,a.useMemo)((()=>({isDuplicate:C,...C?{tooltip:"Duplicate clause"}:{}})),[C]);return a.createElement(H,f,h.label?a.createElement(M,{label:u.label,onChange:c,isLastEmpty:b("label")}):null,h.operator?a.createElement(a.Fragment,null,a.createElement(V,{negate:u.negate,onChange:m}),a.createElement(z,{operator:u.operator,onChange:d,isLastEmpty:b("operator")})):null,h.value?a.createElement(Y,{selectedLabel:u.label,value:u.value,onChange:p,isLastEmpty:b("value")}):null,i?a.createElement(a.Fragment,null,a.createElement(K.A,{vertical:!0,color:"textLite"}),a.createElement(k,{onClick:g},a.createElement(o.Icon,{name:"x",color:"bright"}))):null)},j=e=>{let{clauses:t=[],onAddClause:l,onEditClause:o,onRemoveClause:n,hasIncompleteClause:r}=e;const s=(0,a.useCallback)((()=>{l({})}),[l]);return a.createElement(h,null,t.map(((e,l)=>a.createElement(J,{key:`${e.label}-${e.operator}-${e.value}-${l}`,index:l,clause:e,clauses:t,onEditClause:o,onRemoveClause:n}))),r?null:a.createElement(b,{onClick:s}))},W=e=>{let{index:t,rule:l,onDescriptionChange:n,onAddClause:r,onEditClause:s,onRemoveClause:u,hasIncompleteClause:i}=e;const{description:c,clauses:d=[]}=l||{};return a.createElement(o.Flex,{flex:"grow",column:!0},a.createElement(A,{index:t,description:c,onChange:n}),a.createElement(j,{clauses:d,onAddClause:r,onEditClause:s,onRemoveClause:u,hasIncompleteClause:i}))};var X=l(69765),G=l(31629),Q=l(37618);const Z=(0,T.K0)({key:"nodeMembershipRulesState",get:e=>{let{spaceId:t,roomId:l}=e;return()=>(e=>{let{spaceId:t,roomId:l}=e;return(0,Q.ES)(t)?Promise.resolve({data:{}}):G.A.get(`/api/v3/spaces/${t}/rooms/${l}/node-membership-rules`)})({spaceId:t,roomId:l})},cachePolicy_UNSTABLE:{eviction:"most-recent"}}),ee=()=>{const e=(0,P.vt)(),t=(0,X.ID)();return(0,a.useCallback)((l=>{let{id:a,...o}=l;return a?(e=>{let{spaceId:t,roomId:l,id:a,payload:o}=e;return G.A.put(`/api/v3/spaces/${t}/rooms/${l}/node-membership-rules/${a}`,o)})({spaceId:e,roomId:t,id:a,payload:o}):(e=>{let{spaceId:t,roomId:l,payload:a}=e;return G.A.post(`/api/v3/spaces/${t}/rooms/${l}/node-membership-rules`,a)})({spaceId:e,roomId:t,payload:o})}),[e,t])},te=()=>{const e=(0,P.vt)(),t=(0,X.ID)();return(0,a.useCallback)((l=>l?(e=>{let{spaceId:t,roomId:l,id:a}=e;return G.A.delete(`/api/v3/spaces/${t}/rooms/${l}/node-membership-rules/${a}`)})({spaceId:e,roomId:t,id:l}):Promise.resolve()),[e,t])};var le=l(71835);const ae=e=>{let{index:t,rule:l,onRemove:o,startLoading:n,stopLoading:r,refresh:s}=e;const[u,i]=(0,a.useState)(l),c=ee(),d=te(),[m,p]=(0,le.A)(),g=(0,a.useCallback)((e=>i((t=>({...t,action:e})))),[i]),h=(0,a.useCallback)((e=>{i((t=>({...t,description:e})))}),[i]),b=(0,a.useCallback)((e=>i((t=>({...t,clauses:[...t.clauses,e]})))),[i]),C=(0,a.useCallback)(((e,t)=>{i((l=>({...l,clauses:l.clauses.map(((l,a)=>a==t?e:l))})))}),[i]),f=(0,a.useCallback)((e=>i((t=>({...t,clauses:[...t.clauses.slice(0,e),...t.clauses.slice(e+1)]})))),[i]),v=(0,a.useCallback)((()=>{n(),c(u).then((()=>{m({header:"Success",text:"Successfully saved rule."})})).catch(p).finally((()=>{r(),s()}))}),[u,c,n,r,s,m,p]),E=(0,a.useCallback)((()=>{u.id?(n(),d(u.id).then((()=>{m({header:"Success",text:"Successfully deleted rule."})})).catch(p).finally((()=>{r(),s()}))):o(t)}),[t,u,d,o,n,r,s,m,p]),y=(0,a.useMemo)((()=>u.clauses.find((e=>{let{label:t,operator:l,value:a}=e;return!t||!l||!a}))),[u]),x=(0,a.useMemo)((()=>!!u.action&&!!u.clauses.length&&!y&&JSON.stringify(l)!=JSON.stringify(u)),[l,u,y]);return(0,a.useEffect)((()=>{i(l)}),[l]),{state:u,onActionChange:g,onDescriptionChange:h,onAddClause:b,onEditClause:C,onRemoveClause:f,canSave:x,onSave:v,onDelete:E,hasIncompleteClause:y}},oe=e=>a.createElement(o.ConfirmationDialog,(0,n.A)({title:"Delete rule",confirmLabel:"Yes, delete",declineLabel:"No",message:a.createElement(o.Flex,{gap:2,column:!0},a.createElement(o.TextBig,null,"You are about to delete a node membership rule."),a.createElement(o.TextBig,null,"Are you sure you want to continue?"))},e)),ne={position:"relative",top:"24px",flavour:"hollow",small:!0},re=e=>{let{index:t,item:l,onRemove:r,startLoading:s,stopLoading:u,refresh:i}=e;const{state:d,onActionChange:m,onDescriptionChange:g,onAddClause:h,onEditClause:b,onRemoveClause:C,canSave:f,onSave:v,onDelete:E,hasIncompleteClause:y}=ae({index:t,rule:l,onRemove:r,startLoading:s,stopLoading:u,refresh:i}),[x,,k,I]=(0,w.A)(),S=(0,a.useCallback)((()=>{d.id?k():E()}),[d,k,E]);return a.createElement(a.Fragment,null,a.createElement(p,null,a.createElement(c,(0,n.A)({},d,{onChange:m})),a.createElement(W,{index:t,rule:d,onDescriptionChange:g,onAddClause:h,onEditClause:b,onRemoveClause:C,hasIncompleteClause:y}),a.createElement(o.Flex,{gap:2,padding:[0,0,1,0]},a.createElement(o.Button,(0,n.A)({},ne,{danger:!0,label:"Remove",onClick:S})),a.createElement(o.Button,(0,n.A)({},ne,{label:"Save",onClick:v,disabled:!f})))),x?a.createElement(oe,{handleConfirm:E,handleDecline:I}):null)},se=e=>{let{items:t,onRemove:l,startLoading:n,stopLoading:r,refresh:s}=e;return a.createElement(o.Flex,{column:!0,gap:1},t.map(((e,t)=>a.createElement(re,{key:e.id||`new-rule-${t}`,index:t,item:e,onRemove:l,startLoading:n,stopLoading:r,refresh:s}))))};var ue=l(46741);const ie=e=>{let{loaded:t,rules:l,error:o}=e;const[n,r]=(0,a.useState)(l),s=(0,ue.JT)("room:AddNode"),u=(0,a.useMemo)((()=>!s),[s]),c=(0,a.useMemo)((()=>t&&!!n.length),[t,n]),d=(0,a.useMemo)((()=>t&&!n.length),[t,n]),m=(0,a.useMemo)((()=>!n.find((e=>{let{id:t}=e;return!t}))),[n]),p=(0,a.useCallback)((()=>{r((e=>[...e,{...i}]))}),[r]),g=(0,a.useCallback)((e=>{r((t=>[...t.slice(0,e),...t.slice(e+1)]))}),[r]);return(0,a.useEffect)((()=>{t&&!o&&r(l)}),[l,t,o,r]),{state:n,noPermissions:u,showRulesList:c,showPlaceholder:d,canAddRule:m,onAdd:p,onRemove:g}},ce=(0,I.A)(o.Button),de=()=>{const[e,,t,l]=(0,w.A)(),{loaded:n,value:r=[],error:s,refresh:u}=(()=>{const e=(0,P.vt)(),t=(0,X.ID)(),l=(0,T.xf)(Z({spaceId:e,roomId:t})),a="hasError"===l.state,o=(0,T.RH)(Z({spaceId:e,roomId:t}));return{loaded:"loading"!==l.state,value:l.contents?.data,hasError:a,error:l.contents?.response?.data?.message||l.contents?.response?.data||(a?"Something went wrong.":null),refresh:o}})(),{state:i,noPermissions:c,showRulesList:d,showPlaceholder:p,canAddRule:g,onAdd:h,onRemove:b}=ie({loaded:n,rules:r,error:s}),C=(0,a.useMemo)((()=>({flavour:"hollow",small:!0,label:"Add new rule",disabled:c||!g,onClick:h,...c?{tooltip:"You don't have permission to add new rule."}:g?{}:{tooltip:"You cannot add another rule before saving unsaved rules."}})),[c,g,h]);return e||!n?a.createElement(o.Text,null,"Fetching rules..."):s?a.createElement(o.Text,{color:"error"},s):a.createElement(m,null,d?a.createElement(se,{items:i,onRemove:b,startLoading:t,stopLoading:l,refresh:u}):null,a.createElement(o.Flex,{alignItems:"center",gap:2},a.createElement(ce,C),p?a.createElement(o.Text,null,"When a node in the space matches a rule, it will be automatically included in or excluded from this room.."):null))}}}]);